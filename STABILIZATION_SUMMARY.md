# –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è signalsbot - –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ TP/SL –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–°—Ç–∞—Ç—É—Å**: –£–∂–µ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–Ω–µ–µ
- **–î–µ—Ç–∞–ª–∏**: 
  - –§—É–Ω–∫—Ü–∏—è `check_signal_hits()` —É–¥–∞–ª–µ–Ω–∞ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ —Å—Ç—Ä–æ–∫–µ 1106-1107)
  - `add_completed_signal()` –æ—Ç–∫–ª—é—á–µ–Ω–∞ (no-op)
  - `get_performance_report()` –∏ `send_performance_report()` –æ—Ç–∫–ª—é—á–µ–Ω—ã
  - –í –ª–æ–≥–∞—Ö: `[MAIN] ‚ö†Ô∏è TP/SL monitoring DISABLED`

### 2. ‚úÖ –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π main loop (—Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ä–µ–∂–∏–º)
- **–§–∞–π–ª**: `bot.py`, —Ñ—É–Ω–∫—Ü–∏—è `main_async()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
  - `while True` —Ü–∏–∫–ª (—Å—Ç—Ä–æ–∫–∞ 1932)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
  - `sleep(1)` –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU
  - –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≤—è—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
  - –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
  - –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –≤ `finally` –±–ª–æ–∫–µ (–ø—Ä–∏ Ctrl+C)

### 3. ‚úÖ Circuit Breaker –¥–ª—è TwelveData
- **–§–∞–π–ª**: `twelve_data_client.py`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
  - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ 3 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ (`_circuit_breaker_threshold = 3`)
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π cooldown: –±–∞–∑–∞ 120 —Å–µ–∫—É–Ω–¥, –º–∞–∫—Å–∏–º—É–º 900 —Å–µ–∫—É–Ω–¥ (15 –º–∏–Ω—É—Ç)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `_throttle()` –∏ `get_price()` –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30 —Å–µ–∫—É–Ω–¥
  - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è

### 4. ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **–§–∞–π–ª**: `bot.py`, —Ñ—É–Ω–∫—Ü–∏—è `generate_channel_signals()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
  - `max_attempts = min(len(available_pairs), signals_needed * 2)`
  - –ù–µ –±–æ–ª–µ–µ 1 –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ –≤—Å–µ–º —Å–∏–º–≤–æ–ª–∞–º –∏–ª–∏ `signals_needed * 2` (—á—Ç–æ –º–µ–Ω—å—à–µ)
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: constraint skips –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ attempts

### 5. ‚úÖ "1 –∑–∞–ø—Ä–æ—Å –Ω–∞ 1 —Å–∏–≥–Ω–∞–ª"
- **–§–∞–π–ª**: `bot.py`, —Ñ—É–Ω–∫—Ü–∏—è `generate_channel_signals()`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ time constraints –î–û –∑–∞–ø—Ä–æ—Å–∞ —Ü–µ–Ω—ã (—Å—Ç—Ä–æ–∫–∞ 1514)
  - –î–ª—è –Ω–µ-crypto: `max_retries_override=0` (single-shot, –±–µ–∑ —Ä–µ—Ç—Ä–∞–µ–≤)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: `signal_request_count == 1` (—Å—Ç—Ä–æ–∫–∞ 1574-1577)
  - –ï—Å–ª–∏ count != 1 ‚Üí –æ—à–∏–±–∫–∞ –∏ –ø—Ä–æ–ø—É—Å–∫ —Å–∏–≥–Ω–∞–ª–∞

### 6. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤**:
  - `reason=constraint` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (cooldown –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–∞–º–∏)
  - `reason=active_signal` - –ø–∞—Ä–∞ —É–∂–µ –∏–º–µ–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Å–∏–≥–Ω–∞–ª (24h –ø—Ä–∞–≤–∏–ª–æ)
  - `reason=circuit_breaker_open` - circuit breaker –æ—Ç–∫—Ä—ã—Ç
  - `reason=no_price` - —Ü–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (rate limit/error/unavailable)
- **–ò—Ç–æ–≥–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
  - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ü–∏–∫–ª–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ TwelveData
  - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, attempts, pairs_tried
  - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞: "Bot is alive and running (next cycle in 60s)"

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç —Å–µ–π—á–∞—Å

### –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª (`main_async()`)
```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (startup_init):
   - –°–æ–∑–¥–∞–Ω–∏–µ TwelveDataClient
   - –°–æ–∑–¥–∞–Ω–∏–µ Telegram Bot
   - –ú–∏–≥—Ä–∞—Ü–∏—è state files

2. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª (while True):
   a) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏: –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ 60 —Å–µ–∫—É–Ω–¥ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
   b) –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤:
      - –ü—Ä–æ–≤–µ—Ä–∫–∞ daily limits
      - –ü—Ä–æ–≤–µ—Ä–∫–∞ time constraints (cooldown)
      - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã (1 –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∏–≥–Ω–∞–ª)
      - –†–∞—Å—á–µ—Ç TP/SL
      - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   c) –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   d) sleep(1) - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≤—è—Ç—Å—è
   - –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ logger.exception()
   - –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
   - –ë–æ—Ç –ù–ï –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (Ctrl+C):
   - KeyboardInterrupt ‚Üí graceful shutdown
   - –ó–∞–∫—Ä—ã—Ç–∏–µ TwelveDataClient –≤ finally –±–ª–æ–∫–µ
```

### Circuit Breaker –ª–æ–≥–∏–∫–∞
```
1. –ü—Ä–∏ –æ—à–∏–±–∫–µ (429/timeout/5xx/network):
   - _record_error() ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
   - –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ >= 3 ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç breaker
   - Cooldown = base * 2^(errors-3), max 15 –º–∏–Ω—É—Ç

2. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ:
   - _record_success() ‚Üí —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∏ cooldown

3. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ _is_circuit_breaker_open()
   - –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç None —Å reason="twelve_data_circuit_breaker_open"
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30 —Å–µ–∫—É–Ω–¥)
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
```
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ daily limit (—Å —É—á–µ—Ç–æ–º —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è)
2. –ü–æ–ª—É—á–µ–Ω–∏–µ available_pairs (–∏—Å–∫–ª—é—á–∞—è –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã)
3. –¶–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (max_attempts —Ä–∞–∑):
   a) –ü—Ä–æ–≤–µ—Ä–∫–∞ time constraints (cooldown)
   b) –í—ã–±–æ—Ä –ø–∞—Ä—ã (round-robin)
   c) –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã (1 –∑–∞–ø—Ä–æ—Å, –±–µ–∑ —Ä–µ—Ç—Ä–∞–µ–≤)
   d) –ü—Ä–æ–≤–µ—Ä–∫–∞ 24h –ø—Ä–∞–≤–∏–ª–∞ (pair+direction)
   e) –†–∞—Å—á–µ—Ç TP/SL
   f) –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   g) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏)
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
```

## –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

### Windows
```powershell
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
py bot.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ Python
python bot.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
```
[STARTUP] Initializing Twelve Data client for FOREX...
[STARTUP] ‚úÖ Twelve Data connection test successful (EURUSD=1.12345)
[TELEGRAM_BOT] ‚úÖ Telegram OK: @your_bot_name (id=123456789)
[MAIN] ü§ñ Bot started - running forever (Ctrl+C to stop)
[MAIN] ‚ö†Ô∏è TP/SL monitoring DISABLED - only signal generation enabled
[MAIN] Signal generation interval: 60s
[MAIN] üìä Generating signals for all channels...
[MAIN] ‚úÖ Cycle completed: TwelveData requests: 5
[MAIN] Bot is alive and running (next cycle in 60s)
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **bot.py**:
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –ø—Ä–æ–ø—É—Å–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–¥—Å—á–µ—Ç attempts (constraint skips –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Ç–æ–≥–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ü–∏–∫–ª–∞
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ main loop

2. **twelve_data_client.py**:
   - Circuit breaker —É–∂–µ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ (–Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30 —Å–µ–∫—É–Ω–¥)

3. **data_router.py**:
   - –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç circuit breaker (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - Single-shot —Ä–µ–∂–∏–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ (max_retries=0)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
- ‚úÖ –ë–æ—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç "Checking for TP hits", "TP hit", "SL hit"
- ‚úÖ –ù–∞ 1 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª - —Ä–æ–≤–Ω–æ 1 –∑–∞–ø—Ä–æ—Å –∫ TwelveData
- ‚úÖ –ü—Ä–∏ 429 –±–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –¥–µ–ª–∞–µ—Ç cooldown –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
- ‚úÖ Circuit breaker –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞: constraint/active_signal/no_price/circuit_breaker_open

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏: `[MAIN] Bot is alive and running`
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤: `TwelveData requests: X`
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ circuit breaker: `[CIRCUIT_BREAKER] üî¥ OPEN` –∏–ª–∏ `üü¢ CLOSED`
